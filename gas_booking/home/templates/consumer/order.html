{% extends 'base.html' %}

{% block title %}Consumer | Dashboard{% endblock %}

{% block extra_css %}
{% endblock %}

{% block content %}

{% include 'consumer/navbar.html' %}
<div class="card border-primary" style="width: 50rem; margin-left: 350px; margin-top: 100px;">
    <div class="card-header"><h1 class="text-center">Gas Order</h1></div>
    <form method="post" novalidate action="{% url 'gas_order' %}" > {% csrf_token %}
        <div class="form-group p-4">
            <label for="id_distributor_name" class="form-label ">Choose a Distributor</label>
            <select class="form-select" name="distributor_name" id="id_distributor_name">
                <option disabled selected>Select one distributor...</option>
                {% for dist_name in distributors %}
                    <option value="{{dist_name.id}}">{{dist_name.distributor_name}}</option>
                {% endfor %}
                
            </select>
        </div>
        <div class="form-group p-4">
            <label for="id_gas_name" class="form-label ">Choose Your Gas</label>
            <select class="form-select" name="gas_name" id="id_gas_name">
                <option disabled selected>Select a distributor...</option>
            </select>
        </div>

        <div class="form-check" style="margin: 0px 0px 20px 30px ;">
            <label class="form-check-label" for="flexCheckDefault"><a href="{% url 'terms_conditions' %}">  Agree with the terms and conditions </a></label>
            <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
          </div>
        <!-- <div class="form-group p-4">
            <label for="exampleSelect1" class="form-label"><a href="{% url 'terms_conditions' %}">  Agree with the terms and conditions </a></label>
            {{form.i_agree}}
        </div> -->

        <div class="card-footer">
            <button type="submit" id="submit" disabled class="btn btn-primary" style="width: 40rem; margin-left: 50px !important;">Confirm Order</button>
        </div> 
    </form>
</div>

{% endblock %}

{% block extra_js %}
<script>
// $(document).ready(function(){
    $('#flexCheckDefault').change(function(){
        if($(this).is(":checked")){
            $("#submit").attr("disabled", false);
        }
        else if($(this).is(":not(:checked)")){
            $("#submit").attr("disabled", true);
        }
    });
// });    
    $('#submit').click(function(){
        if($("#id_distributor_name").val() == ''){
            alert("Please! Select a distributor.")
            return false
        }
        if($("#id_gas_name").val() == ''){
            alert("Please! Select a gas.")
            return false
        }
    })
    $("#id_distributor_name").change(function () {
        const distId = $(this).val();  // get the selected subject ID from the HTML dropdown list 
        // alert(distId)
        $.ajax({                       // initialize an AJAX request
            type: "POST",
            url: '{% url "gas_order" %}',
            data: {
                'distributor_id': distId,       // add the country id to the POST parameters
                'csrfmiddlewaretoken':$('input[name=csrfmiddlewaretoken]').val(),
            },
            success: function (data) {   // `data` is from `get_topics_ajax` view function
                let html_data = '<option value="">Choose Gas...</option>';
                data.forEach(function (data) {
                    html_data += `<option value="${data.id}">${data.gas_name}</option>`
                });
                $("#id_gas_name").html(html_data); // replace the contents of the topic input with the data that came from the server
            }
        });
    });
</script>
{% endblock %}
